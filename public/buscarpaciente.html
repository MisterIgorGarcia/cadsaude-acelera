<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Buscar Pacientes</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      background-color: #f0f0f0;
    }
    .container {
      width: 100%;
      height: 100%; /* Aumentado para 130% */
      background-color: #fff;
      padding: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      position: relative;
    }
    h2 {
      text-align: center;
    }
    div {
      margin-bottom: 10px;
      border: 2px solid #ccc;
      border-radius: 3px;
      padding: 10px;
      box-sizing: border-box;
    }
    input[type="text"],
    button {
      width: calc(100% - 20px);
      padding: 10px;
      margin-bottom: 10px;
      border: 2px solid #ccc;
      border-radius: 3px;
      box-sizing: border-box;
      display: block;
      margin: 5px auto;
    }
    button {
      background-color: #007bff;
      color: #fff;
      cursor: pointer;
    }
    button:hover {
      background-color: #0056b3;
    }
    #pacientesList {
      display: flex;
      flex-wrap: wrap;
      justify-content: space-between;
    }
    #pacientesList div {
      width: 30%;
      margin: 1%;
    }
    #backButton {
      position: absolute;
      top: 0;
      left: 0;
      background-color: #6c757d;
      color: #fff;
      cursor: pointer;
      width: 80px;
      height: 40px;
    }
    #backButton:hover {
      background-color: #5a6268;
    }
    #searchContainer {
      position: absolute;
      width: 500px;
      height: 11%;
      top: 0;
      right: 0;
      display: flex; /* Adicionado para alinhar os elementos horizontalmente */
    }
    .searchButton { 
      width: 80px; 
      height: 40px;
    }
    .pagination {
      position: fixed;
      bottom: -10px;
      right: 10px; /* Alterado de 'right' para 'left' */
      display: flex;
      gap: 10px;
      align-items: center;
    }
  </style>
</head>
<body>
    <div class="container">
        <h2>Buscar Pacientes</h2>
        <div id="searchContainer">
          <input type="text" id="searchInput" placeholder="Buscar por nome ou CPF">
          <button class="searchButton" onclick="fetchPacientes()">Buscar</button>
          <button class="searchButton" onclick="resetSearch()">Resetar</button>
        </div>
        <button id="backButton" onclick="window.history.back()">Voltar</button>
        <div id="pacientesList"></div>
        <div class="pagination">
          <button id="prevButton" onclick="prevPage()">Anterior</button>
          <span id="pageCounter">Página 1 de 1</span>
          <button id="nextButton" onclick="nextPage()">Próxima</button>
        </div>
    </div>
    <script>
      let currentPage = 1;
      const itemsPerPage = 9;
      let allPacientes = [];

      // Função modificada para redirecionar para a página de ficha do paciente
      function fetchPacientes() {
        const searchInput = document.getElementById('searchInput').value;
        const xhr = new XMLHttpRequest();
        xhr.open('GET', '/api/buscarpacientes');
        xhr.onload = function() {
          if (xhr.status === 200) {
            allPacientes = JSON.parse(xhr.responseText);
            // Filtrar pacientes com base no nome ou CPF
            if (searchInput) {
              allPacientes = allPacientes.filter(paciente => 
                paciente.nome.includes(searchInput) || paciente.cpf.includes(searchInput)
              );
            }
            renderPacientes();
          }
        };
        xhr.send();
      }
      //Funcao para renderizar os cartões com nome e CPF dos pacientes na tela de busca
      function renderPacientes() {
        const pacientesList = document.getElementById('pacientesList');
        pacientesList.innerHTML = ''; // Limpar lista atual
        const start = (currentPage - 1) * itemsPerPage;
        const end = start + itemsPerPage;
        const pacientesToRender = allPacientes.slice(start, end);

        pacientesToRender.forEach(paciente => {
          pacientesList.innerHTML += `
            <div style="height: 135px; width: 230px; overflow: auto; font-family: 'Arial'; font-size: 12px; color: #333;">
              <p>Nome: ${paciente.nome}</p>
              <p>CPF: ${paciente.cpf}</p>
              <button onclick="window.location.href='fichaPaciente.html?id=${paciente.id}'">Ver Ficha</button>
            </div>
          `;
        });

        updatePagination();
      }
      //Funcao pra adicionar as páginas da lista de cartões
      function updatePagination() {
        const pageCounter = document.getElementById('pageCounter');
        const totalPages = Math.ceil(allPacientes.length / itemsPerPage);
        pageCounter.textContent = `Página ${currentPage} de ${totalPages}`;

        document.getElementById('prevButton').disabled = currentPage === 1;
        document.getElementById('nextButton').disabled = currentPage >= totalPages;
      }

      function nextPage() {
        if (currentPage * itemsPerPage < allPacientes.length) {
          currentPage++;
          renderPacientes();
        }
      }

      function prevPage() {
        if (currentPage > 1) {
          currentPage--;
          renderPacientes();
        }
      }

      // Função para resetar a busca
      function resetSearch() {
        document.getElementById('searchInput').value = '';
        currentPage = 1;
        fetchPacientes();
      }

      // Chamar a função ao carregar a página
      window.onload = fetchPacientes;
    </script>
</body>
</html>
